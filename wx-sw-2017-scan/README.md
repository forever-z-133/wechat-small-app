# 2017上海购物节 - 全城摇一摇
---

2017年上海购物节为期一个月的线下活动，有白天32+黑夜32个二维码在各商户处，扫码即完成签到和抽奖，每10的整数次则额外抽奖1次。

最初选用小程序而非 H5，因为就是想用小程序试试，想略微装个逼。而为了在更多平台上能玩，我们还是做了 H5 版本，比如在阅读原文和朋友圈转发里访问时。

因为本活动涉及到抽奖，所以需要获得用户身份来进行抽奖身份和历史的判断，后端查克拉爆发还去搞通了支付宝用户身份获取那一套。而在纠结了一下之后，我们放弃了支付宝小程序的制作。而且小程序的身份验证对后端来说也因为 code 的存在略有不同。

因此我们要做两个子活动小程序了，有想过做两个小程序进行跳转的方案，但最终还是选择了只做一个，而开发只有两周，沟通又不流畅，实在不能算作较好的代码。

由于活动需要，我们用 **一个二维码** 要做到以下需求

* 微信用户扫开为小程序，无小程序则访问 H5，推文和公众号内链接小程序，长按识别为小程序，朋友圈转发为 H5 和菊花码
* 支付宝打开为 H5，其他软件浏览器打开则提示使用微信
* 在 09.01-09.07 显示活动倒计时海报
* 09.08 为全城摇一摇活动，20:00 之前有倒计时，20:00-21:00 正式抽奖，21:00 后可继续访问
* 09.09-10.08 为期一个月为玩转购物地活动
* 10.09 开始显示活动已结束


还有些其他的什么可以说的呢：

* 在宣传海报上用什么二维码我们产生过一些争执，微信爱好者表示既然已经用了小程序当然用菊花码更好呀，而我的观念是菊花码其实对大众来说并不见得都认识，保守点好。
* swiper 在白天有 4 个 swiper-item 黑夜有 3 个时，如果白天版滑到第 4 个然后切换至黑夜版，会有一个空白的 swiper-item
* 小程序会缓存界面，曾出现过抽奖报错然后退出再打开还是这个界面的情况，体验不佳，所以在 onShow 时需要进行一些初始化
* 小程序遇到死循环时很可怕，甚至我们根本无法告诉用户你的小程序崩掉了，就算关闭再打开也没用，实在不妙